<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¤§çŒ«çŒ«çš„å¥‡å¹»èˆªæµ·</title>
    <style>
        :root {
            --bg-color: #f0f0f0;
            --box-shadow: 4px 4px 0px #333;
            --border: 2px solid #333;
        }

        body {
            margin: 0;
            padding: 0;
            background-color: #222;
            font-family: 'Courier New', Courier, monospace;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            overflow: hidden;
        }

        /* æ‰‹æœºæ¯”ä¾‹å®¹å™¨ */
        #game-container {
            width: 375px;
            height: 667px;
            background-color: var(--bg-color);
            border: 4px solid #fff;
            position: relative;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        /* é€šç”¨æŒ‰é’®æ ·å¼ - å½©è‰²æ–¹å— */
        .pixel-btn {
            padding: 10px;
            margin: 5px;
            border: var(--border);
            box-shadow: var(--box-shadow);
            cursor: pointer;
            text-align: center;
            font-weight: bold;
            transition: transform 0.1s;
            user-select: none;
        }

        .pixel-btn:active {
            transform: translate(2px, 2px);
            box-shadow: 2px 2px 0px #333;
        }

        /* ç•Œé¢åˆ‡æ¢ */
        .screen {
            display: none;
            flex-direction: column;
            width: 100%;
            height: 100%;
        }

        .active { display: flex; }

        /* ä¸»ç•Œé¢ */
        #main-menu { justify-content: center; align-items: center; background: #FFD700; }
        
        /* æ¸¯å£ç•Œé¢å¸ƒå±€ */
        #port-screen { background: #87CEEB; }
        .top-nav { display: flex; justify-content: space-between; padding: 10px; flex: 1; }
        .side-menu { display: flex; flex-direction: column; width: 80px; }
        .side-menu .pixel-btn { font-size: 12px; padding: 5px; background: #fff; }

        /* æ—¥å¿—åŒºåŸŸ */
        #log-area {
            height: 150px;
            background: #333;
            color: #0f0;
            padding: 10px;
            font-size: 12px;
            overflow-y: auto;
            border-top: 4px solid #666;
        }

        /* åº•éƒ¨åŠŸèƒ½æ  */
        .bottom-nav {
            display: flex;
            background: #eee;
            padding: 5px;
            justify-content: space-around;
        }
        .bottom-nav .pixel-btn { font-size: 11px; padding: 5px; margin: 2px; flex: 1; }

        /* é˜µè¥é€‰æ‹© */
        .faction-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            padding: 20px;
        }
        .faction-card { height: 80px; display: flex; flex-direction: column; align-items: center; justify-content: center; }

        .modal {
            position: absolute;
            top: 50%; left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            border: 3px solid #000;
            padding: 20px;
            z-index: 100;
            width: 80%;
            text-align: center;
        }
    </style>
</head>
<body>

<div id="game-container">
    <div id="main-menu" class="screen active">
        <h1 style="text-shadow: 2px 2px #fff;">ğŸˆå¤§çŒ«çŒ«çš„å¥‡å¹»èˆªæµ·</h1>
        <div class="pixel-btn" style="background: #ff6b6b;" onclick="showFactions()">æ–°çš„æ¸¸æˆ</div>
        <div class="pixel-btn" style="background: #4ecdc4;" onclick="showSaves()">è¯»å–å­˜æ¡£</div>
        <div style="flex: 1;"></div>
        <div class="pixel-btn" style="background: #95a5a6; font-size: 12px;" onclick="alert('v0.1: ä¿®æ­£äº†çŒ«çŒ«ä¸åƒé±¼çš„BUGï¼Œå¢åŠ äº†è°ƒæˆä¾å¥³åŠŸèƒ½ã€‚')">æ›´æ–°æ—¥å¿— v0.1</div>
    </div>

    <div id="faction-screen" class="screen">
        <h3 style="text-align: center;">é€‰æ‹©ä½ çš„å‡ºç”Ÿé˜µè¥ï¼ˆé“²å±å®˜é¢†åœ°ï¼‰</h3>
        <div class="faction-grid" id="faction-list"></div>
        <div class="pixel-btn" onclick="goBack()">è¿”å›</div>
    </div>

    <div id="port-screen" class="screen">
        <div class="top-nav">
            <div class="side-menu" id="port-left-menu">
                <div class="pixel-btn" onclick="enterSub('è¡Œæ”¿å…')">è¡Œæ”¿å…</div>
                <div class="pixel-btn" onclick="enterSub('å¸‚åœº')">å¸‚åœº</div>
                <div class="pixel-btn" onclick="enterSub('é…’é¦†')">é…’é¦†</div>
                <div class="pixel-btn" onclick="enterSub('æ—…é¦†')">æ—…é¦†</div>
                <div id="shipyard-btn" class="pixel-btn" onclick="enterSub('é€ èˆ¹å‚')">é€ èˆ¹å‚</div>
            </div>
            <div style="text-align: center; font-weight: bold;" id="current-port-name">é‡Œæ–¯æœ¬</div>
            <div class="side-menu">
                <div class="pixel-btn" style="background: #ffe66d;" onclick="buySupply()">è¡¥ç»™</div>
                <div id="repair-btn" class="pixel-btn" style="background: #ff9f43;" onclick="repairShip()">ä¿®èˆ¹</div>
                <div class="pixel-btn" style="background: #ff6b6b; color: white;" onclick="departConfirm()">å‡ºæ¸¯</div>
            </div>
        </div>

        <div id="sub-menu-overlay" style="display:none; padding: 20px; background: rgba(255,255,255,0.9); flex: 2;">
            <h4 id="sub-title">è¡Œæ”¿å…</h4>
            <div id="sub-content"></div>
            <div class="pixel-btn" onclick="closeSub()">é€€å‡º</div>
        </div>

        <div id="log-area"></div>
        <div class="bottom-nav">
            <div class="pixel-btn" style="background:#ddd" onclick="alert('çŒ«çŒ«å±æ€§ï¼šç²¾åŠ›æ—ºç››')">è§’è‰²</div>
            <div class="pixel-btn" style="background:#ddd">ç¼–ç»„</div>
            <div class="pixel-btn" style="background:#ddd">ç‰©å“</div>
            <div class="pixel-btn" style="background:#ddd">ä»»åŠ¡</div>
            <div class="pixel-btn" style="background:#ff9f43" onclick="saveGame()">å­˜æ¡£</div>
        </div>
    </div>
</div>

<script>
    // æ¸¸æˆæ•°æ®
    const factions = [
        { id: 'ES', name: 'è¥¿ç­ç‰™', color: '#ff4757', ship: 'å°å‹å¡æ‹‰å…‹å¸†èˆ¹', port: 'å¡ç»´åˆ©äºš' },
        { id: 'PT', name: 'è‘¡è„ç‰™', color: '#2ed573', ship: 'å°å‹æ–¹å½¢å¸†èˆ¹', port: 'é‡Œæ–¯æœ¬' },
        { id: 'CN', name: 'å¤§æ˜', color: '#eb4d4b', ship: 'å°å‹ä¸­å›½å¸†èˆ¹', port: 'æ­å·' },
        { id: 'TR', name: 'å¥¥æ–¯æ›¼', color: '#6ab04c', ship: 'å°å‹å¸†æ¡¨ä¸¤ç”¨èˆ¹', port: 'ä¼Šæ–¯å¦å¸ƒå°”' },
        { id: 'VN', name: 'å¨å°¼æ–¯', color: '#535c68', ship: 'å°å‹å¡æ‹‰å…‹å¸†èˆ¹', port: 'å¨å°¼æ–¯' },
        { id: 'EN', name: 'è‹±æ ¼å…°', color: '#70a1ff', ship: 'è‹±æ ¼å…°å°å‹ä¸‰è§’å¸†èˆ¹', port: 'ä¼¦æ•¦' },
        { id: 'NL', name: 'è·å…°', color: '#ffa502', ship: 'å°å‹å¡æ‹‰å…‹å¸†èˆ¹', port: 'é˜¿å§†æ–¯ç‰¹ä¸¹' },
        { id: 'JP', name: 'æ—¥æœ¬', color: '#ffffff', ship: 'å°å‹æ—¥æœ¬å¸†èˆ¹', port: 'é•¿å´' }
    ];

    let player = {
        name: "å¤§çŒ«èˆ¹é•¿",
        faction: null,
        level: 1,
        exp: 0,
        money: 1000,
        supply: 10,
        hull: 100,
        sailors: 5,
        history: ["ã€ç©ºã€‘","ã€ç©ºã€‘","ã€ç©ºã€‘","ã€ç©ºã€‘","ã€ç©ºã€‘","ã€ç©ºã€‘"],
        currentPort: ""
    };

    // åˆå§‹åŒ–é˜µè¥æŒ‰é’®
    function showFactions() {
        switchScreen('faction-screen');
        const list = document.getElementById('faction-list');
        list.innerHTML = '';
        factions.forEach(f => {
            const div = document.createElement('div');
            div.className = 'pixel-btn faction-card';
            div.style.background = f.color;
            div.innerHTML = `<span>ğŸ±</span><span>${f.name}</span>`;
            div.onclick = () => startGame(f);
            list.appendChild(div);
        });
    }

    function startGame(faction) {
        player.faction = faction.name;
        player.currentPort = faction.port;
        addLog(`æ¬¢è¿æ¥åˆ°ã€Šå¤§çŒ«çŒ«çš„å¥‡å¹»èˆªæµ·ã€‹ï¼ä½ é€‰æ‹©äº†${faction.name}ã€‚`);
        addLog(`è·å¾—åˆå§‹èˆ¹åªï¼š${faction.ship}ã€‚`);
        updatePortUI();
        switchScreen('port-screen');
    }

    function switchScreen(id) {
        document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
        document.getElementById(id).classList.add('active');
    }

    function addLog(msg) {
        const log = document.getElementById('log-area');
        log.innerHTML += `<div>> ${msg}</div>`;
        log.scrollTop = log.scrollHeight;
    }

    function updatePortUI() {
        document.getElementById('current-port-name').innerText = player.currentPort;
        // ç®€å•æ¨¡æ‹Ÿå¤§å‹æ¸¯å£æ‰æœ‰é€ èˆ¹å‚
        const hasShipyard = player.currentPort.length % 2 === 0; 
        document.getElementById('shipyard-btn').style.visibility = hasShipyard ? 'visible' : 'hidden';
        document.getElementById('repair-btn').style.visibility = hasShipyard ? 'visible' : 'hidden';
    }

    // å­é¡µé¢é€»è¾‘
    function enterSub(type) {
        const overlay = document.getElementById('sub-menu-overlay');
        const content = document.getElementById('sub-content');
        const title = document.getElementById('sub-title');
        title.innerText = `[${type}] - ${player.currentPort}`;
        content.innerHTML = '';
        overlay.style.display = 'flex';

        if(type === 'é…’é¦†') {
            createSubBtn(content, "è¯·å¤§å®¶å–é…’ (ï¿¥50)", () => { addLog("ä½ è¯·å…¨åœºçŒ«çŒ«å–äº†é±¼æ±¤ï¼Œåå£°ä¸Šå‡äº†ï¼"); });
            createSubBtn(content, "æ‹›å‹Ÿæ°´æ‰‹", () => { 
                player.sailors += 5; 
                addLog("æ‹›å‹Ÿäº†5åªæµæµªçŒ«ä½œä¸ºæ°´æ‰‹ã€‚"); 
            });
            createSubBtn(content, "è°ƒæˆä¾å¥³", () => {
                alert("ä¸å¯ä»¥å“¦ï¼Œæ—®æ—¯ç»™æœ¨é‡Œä¸æ˜¯è¿™æ ·çš„å“¦ï¼ˆå¥½æ„Ÿåº¦ä¸è¶³ï¼‰\n\nç³»ç»Ÿæç¤ºï¼švivo50è§£é”éšè—å‰§æƒ…");
            });
        } else if(type === 'å¸‚åœº') {
            createSubBtn(content, "ä¹°å…¥è´§ç‰©", () => { addLog("èƒ¡æ¤’ï¼š100é‡‘å¸ (æœªè§£é”)"); });
            createSubBtn(content, "å–å‡ºè´§ç‰©", () => { addLog("ä½ å…œé‡Œæ¯”è„¸è¿˜å¹²å‡€ï¼Œå–ç©ºæ°”å—ï¼Ÿ"); });
        }
    }

    function createSubBtn(parent, text, fn) {
        const btn = document.createElement('div');
        btn.className = 'pixel-btn';
        btn.innerText = text;
        btn.onclick = fn;
        parent.appendChild(btn);
    }

    function closeSub() {
        document.getElementById('sub-menu-overlay').style.display = 'none';
    }

    // å‡ºæ¸¯é€»è¾‘
    function departConfirm() {
        if(player.supply <= 0) return alert("ä½ çš„è¡¥ç»™ä¸º0ï¼Œè¯·å…ˆè¿›è¡Œè¡¥ç»™ï¼å°çŒ«é¥¿äº†ä¼šåƒæ‰èˆ¹é•¿çš„ï¼");
        if(player.sailors <= 0) return alert("ä½ æ²¡æœ‰è¶³å¤Ÿçš„æ°´æ‰‹ï¼Œè¯·å…ˆåœ¨é…’é¦†æ‹›å‹Ÿæ°´æ‰‹ã€‚");
        
        let target = prompt("ä½ æƒ³èˆªè¡Œåˆ°å“ªä¸ªæ¸¯å£ï¼Ÿ\n1. é‡Œæ–¯æœ¬\n2. å¡ç»´åˆ©äºš\n3. ä¼¦æ•¦\n4. é©¬èµ›\n5. çƒ­é‚£äºš\n6. çªå°¼æ–¯\n7. XJBæ¢ç´¢");
        if(target === "7") {
            addLog("æ­£åœ¨è¿›è¡ŒXJBæ¢ç´¢èˆªè¡Œ...");
            setTimeout(() => {
                player.supply -= 5;
                addLog("ç”±äºXJBä¹±å¼€ï¼Œè¡¥ç»™æ‰£é™¤5ç‚¹ï¼Œä½ è¯¯æ‰“è¯¯æ’æ¥åˆ°äº†ä¸€ä¸ªæ–°çš„çŒ«ç ‚ç›†ã€‚");
            }, 1000);
        }
    }

    function buySupply() {
        player.supply += 10;
        player.money -= 20;
        addLog(`è´­ä¹°äº†å°é±¼å¹²è¡¥ç»™ï¼ŒèŠ±è´¹20é‡‘å¸ã€‚å½“å‰è¡¥ç»™ï¼š${player.supply}`);
    }

    function saveGame() {
        const saveData = JSON.stringify(player);
        localStorage.setItem('cat_save_1', saveData);
        addLog("å­˜æ¡£æˆåŠŸï¼å–µå–µå·²ç»æŠŠè¿›åº¦è—è¿›çŒ«ç ‚ç›†é‡Œäº†ã€‚");
    }

    function goBack() { switchScreen('main-menu'); }
</script>
</body>
</html>